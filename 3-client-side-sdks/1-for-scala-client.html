<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>Microbuilder</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Customizable and extensible toolkit for transforming lightweight markup languages to various types of output formats, written in Scala" />
    <meta name="keywords" content="scala, text, markup, markdown, restructuredtext, parser, transformer, html, template engine, site generation, open-source" />

    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">

</head>

<body data-spy="scroll" data-target=".toc" data-offset="200">


<div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
        <div class="span4 toc" >

            <ul class="nav nav-list affix">
                <div class="toc">
                  <ul>
                    <li>
                      <p><a class="toc level1" href="../1-overview.html">Overview</a></p>
                      <ul>
                        <li><a class="toc level2" href="../1-overview.html#motive">Motive</a></li>
                        <li><a class="toc level2" href="../1-overview.html#how-microbuilder-works">How Microbuilder works</a></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Microbuilder Interface Definition Language</p>
                      <ul>
                        <li><a class="toc level2" href="../2-microbuilder-interface-definition-language/1-concepts.html">Concepts</a></li>
                        <li>
                          <p><a class="toc level2" href="../2-microbuilder-interface-definition-language/2-interface-definition.html">Interface definition</a></p>
                          <ul>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/2-interface-definition.html#package-and-directory-layout">Package and directory layout</a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/2-interface-definition.html#interfaces-and-methods">Interfaces and methods</a></li>
                          </ul>
                        </li>
                        <li>
                          <p><a class="toc level2" href="../2-microbuilder-interface-definition-language/3-json-schema.html">JSON schema</a></p>
                          <ul>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/3-json-schema.html#request-content-json-schema">Request content JSON schema</a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/3-json-schema.html#response-content-json-schema">Response content JSON schema</a></li>
                            <li>
                              <p><a class="toc level3" href="../2-microbuilder-interface-definition-language/3-json-schema.html#built-in-types-for-json-schema">Built-in types for JSON schema</a></p>
                              <ul>
                                <li><a class="toc level4" href="../2-microbuilder-interface-definition-language/3-json-schema.html#primary-types">Primary types</a></li>
                                <li><a class="toc level4" href="../2-microbuilder-interface-definition-language/3-json-schema.html#array-types">Array types</a></li>
                              </ul>
                            </li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/3-json-schema.html#custom-class-types">Custom class types</a></li>
                          </ul>
                        </li>
                        <li>
                          <p><a class="toc level2" href="../2-microbuilder-interface-definition-language/4-annotations.html">Annotations</a></p>
                          <ul>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#id-1"><code>@:structuralFailure</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#1"><code>@:nativeGen</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#2"><code>@:route</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#3"><code>@:requestContentType</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#4"><code>@:responseContentType</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#5"><code>@:requestHeader</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#6"><code>@:final</code></a></li>
                            <li><a class="toc level3" href="../2-microbuilder-interface-definition-language/4-annotations.html#7"><code>@:transient</code></a></li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Client-side SDKs</p>
                      <ul>
                        <li>
                          <p class="toc level2 active">For Scala client</p>
                          <ul>
                            <li><a class="toc level3" href="#requirement">Requirement</a></li>
                            <li>
                              <p><a class="toc level3" href="#create-the-sdk">Create the SDK</a></p>
                              <ul>
                                <li><a class="toc level4" href="#sbt-configuration-for-sdk">Sbt configuration for SDK</a></li>
                                <li><a class="toc level4" href="#midl-api-definition">MIDL API definition</a></li>
                                <li><a class="toc level4" href="#midl-json-schema-definition">MIDL JSON schema definition</a></li>
                              </ul>
                            </li>
                            <li><a class="toc level3" href="#publish-the-sdk">Publish the SDK</a></li>
                            <li><a class="toc level3" href="#dependency-settings-for-client-application">Dependency settings for Client application</a></li>
                            <li><a class="toc level3" href="#use-sdk">Use SDK</a></li>
                          </ul>
                        </li>
                        <li><a class="toc level2" href="2-for-javascript-client.html">For JavaScript client</a></li>
                        <li><a class="toc level2" href="3-for-other-language-client.html">For other language client</a></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Server-side stubs</p>
                      <ul>
                        <li><a class="toc level2" href="../4-server-side-stubs/1-for-scala-server.html">For Scala server</a></li>
                        <li><a class="toc level2" href="../4-server-side-stubs/2-for-other-language-server.html">For other language server</a></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Generating Documentation</p>
                      <ul>
                        <li><a class="toc level2" href="../5-generating-documentation/1-haxedoc.html">Haxedoc</a></li>
                        <li><a class="toc level2" href="../5-generating-documentation/2-swagger-ui.html">Swagger UI</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
            </ul>

        </div>

        <div class="span8" id="top">

            
            <h1 id="for-scala-client" class="title">For Scala client</h1>
            <p>In order to call a RESTful JSON API from a Scala application,
            you need the following steps:</p>
            <ol class="arabic">
              <li>Create a Sbt project, which contains the MIDL definition of the RESTful JSON API
              that you will call in your Scala application.
              The project is also known as the API&#39;s SDK.</li>
            </ol>
            <ol class="arabic">
              <li>Publish the JAR package of SDK (optional).</li>
            </ol>
            <ol class="arabic">
              <li>Add the dependency of SDK to your Scala application.</li>
            </ol>
            <ol class="arabic">
              <li>In your Scala application, initilize the service defined in SDK and invoke methods of the service.</li>
            </ol>
            <p>In this article,
            we will create an application that queries the public organization memberships for a specified Github user.
            The application is a Scala Play web project,
            and will call <a href="https://developer.github.com/v3/">Github API</a> via a Microbuilder SDK,
            which is also created in this article.</p>
            
            <h2 id="requirement" class="section">Requirement</h2>
            <p>Microbuilder requires <a href="http://haxe.org/">Haxe</a> for code generation,
            and <a href="http://www.scala-sbt.org/">Sbt</a> to manage build pipeline.</p>
            <p>You need download and install <a href="http://haxe.org/download/">Haxe 3.2.1</a> and
            <a href="http://www.scala-sbt.org/download.html">Sbt 0.13.9</a>,
            then setup Haxelib with the folloiwing commands:</p>
            <pre><code>haxelib setup ~/.haxelib.d
haxelib install hxjava
haxelib install dox
haxelib install hxcs</code></pre>
            
            <h2 id="create-the-sdk" class="section">Create the SDK</h2>
            
            <h3 id="sbt-configuration-for-sdk" class="section">Sbt configuration for SDK</h3>
            <p>Prepare an empty directory for the SDK project.
            Then, create <code>project/plugins.sbt</code>
            and add <a href="https://github.com/ThoughtWorksInc/sbt-microbuilder">sbt-microbuilder</a> dependency into it.</p>
            <pre><code>// project/plugins.sbt
addSbtPlugin(&quot;com.thoughtworks.microbuilder&quot; % &quot;sbt-microbuilder&quot; % &quot;3.0.1&quot;)</code></pre>
            <p>There are multiple plugins in the sbt-microbuilder library.
            <code>MicrobuilderJavaSdk</code> is one of these plugins.
            The plugin will add necessary settings for a SDK project for JVM target.</p>
            <p>So you edit build.sbt, and add <code>enablePlugins(MicrobuilderJavaSdk)</code>:</p>
            <pre><code>// build.sbt
enablePlugins(MicrobuilderJavaSdk)

organization := &quot;com.thoughtworks.microbuilder.tutorial&quot;

name := &quot;github-sdk&quot;</code></pre>
            
            <h3 id="midl-api-definition" class="section">MIDL API definition</h3>
            <p>By default, your MIDL is under <code>src/haxe</code> directory,
            and the package name of your MIDL is caculated from <code>organization</code> and <code>name</code> settings in your <code>build.sbt</code>.</p>
            <p>The interface of MIDL API should be put under <code>com.thoughtworks.microbuilder.tutorial.githubSdk.rpc</code> package,
            or <code>src/haxe/com/thoughtworks/microbuilder/tutorial/githubSdk/rpc</code> directory.
            You can run <code>sbt jsonStreamServiceModules::packageName</code> in shell to check that.</p>
            <p>Now you define <a href="https://developer.github.com/v3/orgs/#list-user-organizations">List user organizations</a>
            endpoint in a MIDL interface.</p>
            <pre><code>// src/haxe/com/thoughtworks/microbuilder/tutorial/githubSdk/rpc/IOrganizationService.hx
package com.thoughtworks.microbuilder.tutorial.githubSdk.rpc;

import jsonStream.rpc.Future;
import haxe.ds.Vector;
import com.thoughtworks.microbuilder.tutorial.githubSdk.model.OrgnizationSummary;

@:nativeGen
interface IOrganizationService {

  @:route(&quot;GET&quot;, &quot;/users/{username}/orgs&quot;)
  function listUserOrganizations(username:String):Future&lt;Vector&lt;OrgnizationSummary&gt;&gt;;

  // TODO: Other endpoints described at https://developer.github.com/v3/orgs/

}</code></pre>
            
            <h3 id="midl-json-schema-definition" class="section">MIDL JSON schema definition</h3>
            <p>The MIDL reference to a MIDL JSON schema <code>OrgnizationSummary</code>,
            which should be defined under <code>com.thoughtworks.microbuilder.tutorial.githubSdk.model</code> package,
            or <code>src/haxe/com/thoughtworks/microbuilder/tutorial/githubSdk/model</code> directory.
            You can run <code>sbt jsonStreamModelModules::packageName</code> in shell to check that.</p>
            <pre><code>// src/haxe/com/thoughtworks/microbuilder/tutorial/githubSdk/model/OrgnizationSummary.hx
package com.thoughtworks.microbuilder.tutorial.githubSdk.model;

@:final
class OrgnizationSummary {

  public function new() {}

  public var login:String;

  public var id:Int;

  public var url:String;

  public var avatar_url:String;

  public var description:String;

}</code></pre>
            <p>Now you can execute the following command to compile and package the SDK to a JAR.</p>
            <pre><code>sbt haxelibInstallDependencies package</code></pre>
            
            <h2 id="publish-the-sdk" class="section">Publish the SDK</h2>
            <p>See <a href="http://www.scala-sbt.org/0.13/docs/Publishing.html">Publishing</a> in Sbt documentation for how to setup Sbt to publish your SDK.</p>
            <p>See this <a href="https://github.com/ThoughtWorksInc/github-sdk/tree/v1.0.0">repository</a> for the complete code base.</p>
            
            <h2 id="dependency-settings-for-client-application" class="section">Dependency settings for Client application</h2>
            <p>Now, create your client-side application.</p>
            <p>(To be continued)</p>
            
            <h2 id="use-sdk" class="section">Use SDK</h2>
            <p>(To be continued)</p>

        </div>
    </div>

</div>

</body></html>
